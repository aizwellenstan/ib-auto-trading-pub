import sys
sys.path.append('../')
from modules.aiztradingview import GetAll
import yfinance as yf
from datetime import datetime as dt, timedelta
from modules.shareholders import CheckIncomeIncrease
from modules.sharpe import GetMaxDD

symbolList = GetAll()

longTernDict = {'INFY': 18.709999084472656, 'MGIC': 19.200000762939453, 'MRTN': 20.209999084472656, 'SHEN': 21.280000686645508, 'SFNC': 21.770000457763672, 'JHX': 23.420000076293945, 'PHI': 29.15999984741211, 'BKE': 29.43000030517578, 'VIVO': 32.5099983215332, 'AROW': 32.58000183105469, 'GABC': 34.790000915527344, 'CMC': 35.7400016784668, 'UBSI': 36.439998626708984, 'MDC': 36.61000061035156, 'FFIN': 41.029998779296875, 'CASH':
41.36000061035156, 'YORW': 41.65999984741211, 'NRIM': 41.720001220703125, 'WTRG': 47.43000030517578, 'PNR': 47.970001220703125,
'FAST': 48.5, 'GBCI': 49.2400016784668, 'WASH': 49.650001525878906, 'GCBC': 49.709999084472656,
'STC': 51.130001068115234, 'ARTNA': 51.599998474121094, 'LKQ': 52.7599983215332, 'PLUS': 52.849998474121094, 'WABC': 56.099998474121094, 'LNT': 57.16999816894531, 'HDB': 57.18000030517578, 'SEE': 57.75, 'TREX': 59.939998626708984, 'TD': 63.68000030517578,
'OTTR': 67.12000274658203, 'XEL': 68.86000061035156, 'BALL': 69.9800033569336, 'PNW': 70.20999908447266, 'CP': 73.94999694824219, 'DHI': 74.27999877929688, 'GIS': 74.37000274658203, 'UFPI': 74.56999969482422, 'BBY': 75.97000122070312, 'ENSG': 76.0199966430664, 'MGEE': 76.69999694824219,
'CLFD': 78.37999725341797, 'LEN': 79.3499984741211, 'PLXS': 81.30999755859375, 'AWR': 81.72000122070312, 'TTC': 82.41000366210938, 'BMI': 82.69000244140625, 'MTH': 85.01000213623047, 'AMD': 85.87999725341797, 'UMBF': 88.66000366210938, 'ASGN': 93.51000213623047, 'EXPO': 93.52999877929688, 'CHD': 94.08999633789062, 'WEC': 99.06999969482422, 'CRMT': 99.12000274658203, 'TER': 99.2300033569336, 'GRMN': 103.23999786376953, 'MGPI': 103.43000030517578, 'USLM': 105.22000122070312, 'IDA': 105.94000244140625, 'SSD':
106.91000366210938, 'UHS': 107.72000122070312, 'ABT': 109.93000030517578, 'SWK': 112.54000091552734, 'AME': 112.9000015258789, 'GOOGL': 113.80999755859375, 'NVO': 115.81999969482422, 'AMZN': 118.20999908447266, 'CPRT': 121.41000366210938, 'DOV': 124.91000366210938, 'AMED': 125.37000274658203, 'TTWO': 126.97000122070312, 'CPK': 128.05999755859375, 'BCPC': 130.35000610351562, 'PWR':
131.11000061035156, 'DGX': 136.66000366210938, 'WSM': 137.50999450683594, 'ITIC': 141.25, 'TTEK': 141.3300018310547, 'TGT': 153.36000061035156, 'TRV': 158.35000610351562, 'RGEN': 168.07000732421875, 'MED': 173.74000549316406, 'GPI': 177.6999969482422, 'AAP': 190.64999389648438, 'NFLX': 201.6300048828125, 'NICE': 203.10000610351562, 'TSCO': 205.6300048828125, 'SAIA': 209.39999389648438, 'ROK': 216.39999389648438,
'ADP': 218.9499969482422, 'CVCO': 229.5, 'APD': 230.0, 'GNRC': 230.5800018310547, 'ESLT': 232.32000732421875, 'IT': 247.57000732421875, 'DHR': 255.75, 'WSO': 257.0899963378906, 'MSFT': 259.5299987792969, 'ODFL': 270.6499938964844, 'ACN': 280.0400085449219, 'MCO': 289.1400146484375, 'DECK': 289.57000732421875, 'LAD': 295.55999755859375, 'HD': 299.8299865722656, 'WST': 300.19000244140625, 'HIFS': 318.2200012207031, 'EPAM': 323.4200134277344, 'SNPS': 323.510009765625, 'KLAC': 345.5799865722656, 'SPGI': 357.1400146484375, 'IDXX': 377.1000061035156, 'POOL': 386.489990234375, 'INTU': 403.8599853515625, 'MPWR': 426.239990234375, 'SIVB': 426.70001220703125, 'ELV': 497.42999267578125, 'ASML': 498.3599853515625, 'COST': 520.22998046875, 'UNH': 533.4500122070312, 'TMO': 536.8699951171875, 'ORLY': 689.3200073242188, 'FCNCA': 693.510009765625, 'MTD': 1156.8699951171875, 'CMG': 1342.530029296875,
'NVR': 4458.2900390625}

longTernDict = {'INFY': 18.709999084472656, 'SHEN': 21.280000686645508, 'SFNC': 21.770000457763672, 'JHX': 23.420000076293945, 'PHI': 29.15999984741211, 'BKE': 29.43000030517578, 'VIVO': 32.5099983215332, 'AROW': 32.58000183105469, 'GABC': 34.790000915527344, 'CMC': 35.7400016784668, 'UBSI': 36.439998626708984, 'MDC': 36.61000061035156, 'FFIN': 41.029998779296875,
'YORW': 41.65999984741211, 'WTRG': 47.43000030517578, 'PNR': 47.970001220703125, 'FAST': 48.5, 'GBCI': 49.2400016784668, 'WASH': 49.650001525878906, 'GCBC': 49.709999084472656, 'STC': 51.130001068115234, 'ARTNA': 51.599998474121094, 'WABC': 56.099998474121094, 'LNT': 57.16999816894531, 'HDB': 57.18000030517578, 'SEE':
57.75, 'OTTR': 67.12000274658203, 'XEL': 68.86000061035156, 'BALL': 69.9800033569336, 'PNW': 70.20999908447266, 'CP': 73.94999694824219, 'UFPI': 74.56999969482422, 'BBY': 75.97000122070312, 'MGEE': 76.69999694824219, 'LEN':
79.3499984741211, 'PLXS': 81.30999755859375, 'AWR': 81.72000122070312, 'TTC': 82.41000366210938, 'BMI': 82.69000244140625, 'AMD': 85.87999725341797, 'UMBF': 88.66000366210938, 'CHD': 94.08999633789062, 'WEC': 99.06999969482422, 'CRMT': 99.12000274658203, 'TER': 99.2300033569336, 'MGPI':
103.43000030517578, 'USLM': 105.22000122070312, 'IDA': 105.94000244140625, 'SSD': 106.91000366210938, 'UHS': 107.72000122070312, 'ABT': 109.93000030517578, 'SWK': 112.54000091552734, 'AME': 112.9000015258789, 'GOOGL': 113.80999755859375, 'AMZN': 118.20999908447266, 'CPRT': 121.41000366210938, 'DOV': 124.91000366210938, 'AMED': 125.37000274658203, 'CPK': 128.05999755859375, 'DGX': 136.66000366210938, 'TTEK': 141.3300018310547, 'TGT': 153.36000061035156, 'TRV': 158.35000610351562, 'NFLX': 201.6300048828125, 'TSCO': 205.6300048828125, 'SAIA': 209.39999389648438, 'ROK': 216.39999389648438, 'ADP': 218.9499969482422, 'CVCO': 229.5, 'APD': 230.0, 'GNRC': 230.5800018310547, 'IT': 247.57000732421875, 'DHR': 255.75, 'WSO': 257.0899963378906, 'MSFT': 259.5299987792969, 'ODFL': 270.6499938964844, 'ACN': 280.0400085449219, 'MCO': 289.1400146484375, 'LAD': 295.55999755859375, 'HD': 299.8299865722656, 'WST': 300.19000244140625, 'KLAC': 345.5799865722656, 'SPGI': 357.1400146484375, 'IDXX': 377.1000061035156, 'POOL': 386.489990234375, 'INTU': 403.8599853515625, 'SIVB': 426.70001220703125, 'ELV': 497.42999267578125, 'COST': 520.22998046875, 'UNH': 533.4500122070312, 'TMO': 536.8699951171875, 'ORLY': 689.3200073242188, 'FCNCA': 693.510009765625, 'CMG': 1342.530029296875}

def GetDf(ticker):
    stockInfo = yf.Ticker(ticker)
    df = stockInfo.history(period="max")
    return df

def GetPerformance(ticker):
    try:
        df = GetDf(ticker)
        ipoPrice = df.iloc[0].Open
        if (df.iloc[0].Open == 0):
            for i in range(1, len(df)):
                if df.iloc[i].Open > 0:
                    ipoPrice = df.iloc[i].Open
                    break
        performance = df.iloc[-1].Close/ipoPrice
        return performance
    except: return 0
marketPerformance = GetPerformance('SPY')
print(marketPerformance)

longTern = {}
for sym in symbolList:
    if CheckIncomeIncrease(sym):
        performance = GetPerformance(sym)
        if performance > marketPerformance:
            price = GetDf(sym).iloc[-1].Close
            print(sym,price)
            longTern[sym] = price

longTern = dict(sorted(longTern.items(), key=lambda item: item[1]))
print(longTern)